{
  "version": "tree-0.1",
  "tree": {
    "id": "App",
    "path": "",
    "children": {
      "Tree": {
        "id": "Tree",
        "path": "Tree",
        "constructInfo": {
          "fqn": "constructs.Construct",
          "version": "10.0.91"
        }
      },
      "GuarddutyHandsOnStack": {
        "id": "GuarddutyHandsOnStack",
        "path": "GuarddutyHandsOnStack",
        "children": {
          "ExistingVPC": {
            "id": "ExistingVPC",
            "path": "GuarddutyHandsOnStack/ExistingVPC",
            "children": {
              "PublicSubnetSubnet1": {
                "id": "PublicSubnetSubnet1",
                "path": "GuarddutyHandsOnStack/ExistingVPC/PublicSubnetSubnet1",
                "constructInfo": {
                  "fqn": "aws-cdk-lib.Resource",
                  "version": "2.17.0"
                }
              },
              "PublicSubnetSubnet2": {
                "id": "PublicSubnetSubnet2",
                "path": "GuarddutyHandsOnStack/ExistingVPC/PublicSubnetSubnet2",
                "constructInfo": {
                  "fqn": "aws-cdk-lib.Resource",
                  "version": "2.17.0"
                }
              },
              "PublicSubnet1": {
                "id": "PublicSubnet1",
                "path": "GuarddutyHandsOnStack/ExistingVPC/PublicSubnet1",
                "constructInfo": {
                  "fqn": "aws-cdk-lib.Resource",
                  "version": "2.17.0"
                }
              },
              "PublicSubnet2": {
                "id": "PublicSubnet2",
                "path": "GuarddutyHandsOnStack/ExistingVPC/PublicSubnet2",
                "constructInfo": {
                  "fqn": "aws-cdk-lib.Resource",
                  "version": "2.17.0"
                }
              },
              "PublicSubnet3": {
                "id": "PublicSubnet3",
                "path": "GuarddutyHandsOnStack/ExistingVPC/PublicSubnet3",
                "constructInfo": {
                  "fqn": "aws-cdk-lib.Resource",
                  "version": "2.17.0"
                }
              },
              "PrivateSubnet1": {
                "id": "PrivateSubnet1",
                "path": "GuarddutyHandsOnStack/ExistingVPC/PrivateSubnet1",
                "constructInfo": {
                  "fqn": "aws-cdk-lib.Resource",
                  "version": "2.17.0"
                }
              },
              "PrivateSubnet2": {
                "id": "PrivateSubnet2",
                "path": "GuarddutyHandsOnStack/ExistingVPC/PrivateSubnet2",
                "constructInfo": {
                  "fqn": "aws-cdk-lib.Resource",
                  "version": "2.17.0"
                }
              },
              "PrivateSubnetSubnet1": {
                "id": "PrivateSubnetSubnet1",
                "path": "GuarddutyHandsOnStack/ExistingVPC/PrivateSubnetSubnet1",
                "constructInfo": {
                  "fqn": "aws-cdk-lib.Resource",
                  "version": "2.17.0"
                }
              },
              "PrivateSubnetSubnet2": {
                "id": "PrivateSubnetSubnet2",
                "path": "GuarddutyHandsOnStack/ExistingVPC/PrivateSubnetSubnet2",
                "constructInfo": {
                  "fqn": "aws-cdk-lib.Resource",
                  "version": "2.17.0"
                }
              },
              "IsolatedSubnetSubnet1": {
                "id": "IsolatedSubnetSubnet1",
                "path": "GuarddutyHandsOnStack/ExistingVPC/IsolatedSubnetSubnet1",
                "constructInfo": {
                  "fqn": "aws-cdk-lib.Resource",
                  "version": "2.17.0"
                }
              },
              "IsolatedSubnetSubnet2": {
                "id": "IsolatedSubnetSubnet2",
                "path": "GuarddutyHandsOnStack/ExistingVPC/IsolatedSubnetSubnet2",
                "constructInfo": {
                  "fqn": "aws-cdk-lib.Resource",
                  "version": "2.17.0"
                }
              }
            },
            "constructInfo": {
              "fqn": "aws-cdk-lib.Resource",
              "version": "2.17.0"
            }
          },
          "dynamodb-password": {
            "id": "dynamodb-password",
            "path": "GuarddutyHandsOnStack/dynamodb-password",
            "children": {
              "Resource": {
                "id": "Resource",
                "path": "GuarddutyHandsOnStack/dynamodb-password/Resource",
                "attributes": {
                  "aws:cdk:cloudformation:type": "AWS::SSM::Parameter",
                  "aws:cdk:cloudformation:props": {
                    "type": "String",
                    "value": "NA",
                    "description": "Sample secret for generating GuardDuty findings.",
                    "name": "guardduty_dynamodb_password_sample"
                  }
                },
                "constructInfo": {
                  "fqn": "aws-cdk-lib.aws_ssm.CfnParameter",
                  "version": "2.17.0"
                }
              }
            },
            "constructInfo": {
              "fqn": "aws-cdk-lib.aws_ssm.StringParameter",
              "version": "2.17.0"
            }
          },
          "Table": {
            "id": "Table",
            "path": "GuarddutyHandsOnStack/Table",
            "children": {
              "Resource": {
                "id": "Resource",
                "path": "GuarddutyHandsOnStack/Table/Resource",
                "attributes": {
                  "aws:cdk:cloudformation:type": "AWS::DynamoDB::Table",
                  "aws:cdk:cloudformation:props": {
                    "keySchema": [
                      {
                        "attributeName": "name",
                        "keyType": "HASH"
                      }
                    ],
                    "attributeDefinitions": [
                      {
                        "attributeName": "name",
                        "attributeType": "S"
                      }
                    ],
                    "provisionedThroughput": {
                      "readCapacityUnits": 5,
                      "writeCapacityUnits": 5
                    },
                    "tableName": "GuardDuty-HandsOn-CustomerDB"
                  }
                },
                "constructInfo": {
                  "fqn": "aws-cdk-lib.aws_dynamodb.CfnTable",
                  "version": "2.17.0"
                }
              },
              "ScalingRole": {
                "id": "ScalingRole",
                "path": "GuarddutyHandsOnStack/Table/ScalingRole",
                "constructInfo": {
                  "fqn": "aws-cdk-lib.Resource",
                  "version": "2.17.0"
                }
              }
            },
            "constructInfo": {
              "fqn": "aws-cdk-lib.aws_dynamodb.Table",
              "version": "2.17.0"
            }
          },
          "guardduty-threat-list-bucket": {
            "id": "guardduty-threat-list-bucket",
            "path": "GuarddutyHandsOnStack/guardduty-threat-list-bucket",
            "children": {
              "Resource": {
                "id": "Resource",
                "path": "GuarddutyHandsOnStack/guardduty-threat-list-bucket/Resource",
                "attributes": {
                  "aws:cdk:cloudformation:type": "AWS::S3::Bucket",
                  "aws:cdk:cloudformation:props": {
                    "bucketName": "guardduty-threat-list-us-east-1-381354187112"
                  }
                },
                "constructInfo": {
                  "fqn": "aws-cdk-lib.aws_s3.CfnBucket",
                  "version": "2.17.0"
                }
              }
            },
            "constructInfo": {
              "fqn": "aws-cdk-lib.aws_s3.Bucket",
              "version": "2.17.0"
            }
          },
          "guardduty-log-bucket": {
            "id": "guardduty-log-bucket",
            "path": "GuarddutyHandsOnStack/guardduty-log-bucket",
            "children": {
              "Resource": {
                "id": "Resource",
                "path": "GuarddutyHandsOnStack/guardduty-log-bucket/Resource",
                "attributes": {
                  "aws:cdk:cloudformation:type": "AWS::S3::Bucket",
                  "aws:cdk:cloudformation:props": {
                    "accessControl": "LogDeliveryWrite",
                    "bucketName": "guardduty-log-us-east-1-381354187112"
                  }
                },
                "constructInfo": {
                  "fqn": "aws-cdk-lib.aws_s3.CfnBucket",
                  "version": "2.17.0"
                }
              }
            },
            "constructInfo": {
              "fqn": "aws-cdk-lib.aws_s3.Bucket",
              "version": "2.17.0"
            }
          },
          "guardduty-compromised-bucket": {
            "id": "guardduty-compromised-bucket",
            "path": "GuarddutyHandsOnStack/guardduty-compromised-bucket",
            "children": {
              "Resource": {
                "id": "Resource",
                "path": "GuarddutyHandsOnStack/guardduty-compromised-bucket/Resource",
                "attributes": {
                  "aws:cdk:cloudformation:type": "AWS::S3::Bucket",
                  "aws:cdk:cloudformation:props": {
                    "bucketName": "guardduty-compromised-us-east-1-381354187112",
                    "loggingConfiguration": {
                      "destinationBucketName": {
                        "Ref": "guarddutylogbucket108BF635"
                      }
                    }
                  }
                },
                "constructInfo": {
                  "fqn": "aws-cdk-lib.aws_s3.CfnBucket",
                  "version": "2.17.0"
                }
              }
            },
            "constructInfo": {
              "fqn": "aws-cdk-lib.aws_s3.Bucket",
              "version": "2.17.0"
            }
          },
          "role": {
            "id": "role",
            "path": "GuarddutyHandsOnStack/role",
            "children": {
              "Resource": {
                "id": "Resource",
                "path": "GuarddutyHandsOnStack/role/Resource",
                "attributes": {
                  "aws:cdk:cloudformation:type": "AWS::IAM::Role",
                  "aws:cdk:cloudformation:props": {
                    "assumeRolePolicyDocument": {
                      "Statement": [
                        {
                          "Action": "sts:AssumeRole",
                          "Effect": "Allow",
                          "Principal": {
                            "Service": "ec2.amazonaws.com"
                          }
                        }
                      ],
                      "Version": "2012-10-17"
                    },
                    "managedPolicyArns": [
                      {
                        "Fn::Join": [
                          "",
                          [
                            "arn:",
                            {
                              "Ref": "AWS::Partition"
                            },
                            ":iam::aws:policy/service-role/AmazonEC2RoleforSSM"
                          ]
                        ]
                      }
                    ]
                  }
                },
                "constructInfo": {
                  "fqn": "aws-cdk-lib.aws_iam.CfnRole",
                  "version": "2.17.0"
                }
              }
            },
            "constructInfo": {
              "fqn": "aws-cdk-lib.aws_iam.Role",
              "version": "2.17.0"
            }
          },
          "security-group": {
            "id": "security-group",
            "path": "GuarddutyHandsOnStack/security-group",
            "children": {
              "Resource": {
                "id": "Resource",
                "path": "GuarddutyHandsOnStack/security-group/Resource",
                "attributes": {
                  "aws:cdk:cloudformation:type": "AWS::EC2::SecurityGroup",
                  "aws:cdk:cloudformation:props": {
                    "groupDescription": "GuarddutyHandsOnStack/security-group",
                    "groupName": "GuardDuty-HandsOn-target",
                    "securityGroupEgress": [
                      {
                        "cidrIp": "0.0.0.0/0",
                        "description": "Allow all outbound traffic by default",
                        "ipProtocol": "-1"
                      }
                    ],
                    "securityGroupIngress": [
                      {
                        "cidrIp": "0.0.0.0/0",
                        "ipProtocol": "icmp",
                        "fromPort": -1,
                        "toPort": -1,
                        "description": "Allow ICMP traffic from a specific IP range"
                      }
                    ],
                    "vpcId": "vpc-05c3438e678ec0b90"
                  }
                },
                "constructInfo": {
                  "fqn": "aws-cdk-lib.aws_ec2.CfnSecurityGroup",
                  "version": "2.17.0"
                }
              }
            },
            "constructInfo": {
              "fqn": "aws-cdk-lib.aws_ec2.SecurityGroup",
              "version": "2.17.0"
            }
          },
          "malicious-iam-user-1-policy": {
            "id": "malicious-iam-user-1-policy",
            "path": "GuarddutyHandsOnStack/malicious-iam-user-1-policy",
            "children": {
              "Resource": {
                "id": "Resource",
                "path": "GuarddutyHandsOnStack/malicious-iam-user-1-policy/Resource",
                "attributes": {
                  "aws:cdk:cloudformation:type": "AWS::IAM::Policy",
                  "aws:cdk:cloudformation:props": {
                    "policyDocument": {
                      "Statement": [
                        {
                          "Action": [
                            "ssm:GetParameter",
                            "ssm:GetParameters",
                            "ssm:DescribeParameters"
                          ],
                          "Effect": "Allow",
                          "Resource": "arn:aws:ssm:us-east-1:381354187112:*"
                        }
                      ],
                      "Version": "2012-10-17"
                    },
                    "policyName": "maliciousiamuser1policyB0DFEF83",
                    "users": [
                      {
                        "Ref": "maliciousiamuser198EE1146"
                      }
                    ]
                  }
                },
                "constructInfo": {
                  "fqn": "aws-cdk-lib.aws_iam.CfnPolicy",
                  "version": "2.17.0"
                }
              }
            },
            "constructInfo": {
              "fqn": "aws-cdk-lib.aws_iam.Policy",
              "version": "2.17.0"
            }
          },
          "malicious-iam-user-1": {
            "id": "malicious-iam-user-1",
            "path": "GuarddutyHandsOnStack/malicious-iam-user-1",
            "children": {
              "Resource": {
                "id": "Resource",
                "path": "GuarddutyHandsOnStack/malicious-iam-user-1/Resource",
                "attributes": {
                  "aws:cdk:cloudformation:type": "AWS::IAM::User",
                  "aws:cdk:cloudformation:props": {}
                },
                "constructInfo": {
                  "fqn": "aws-cdk-lib.aws_iam.CfnUser",
                  "version": "2.17.0"
                }
              }
            },
            "constructInfo": {
              "fqn": "aws-cdk-lib.aws_iam.User",
              "version": "2.17.0"
            }
          },
          "malicious-iam-user-1-access-key": {
            "id": "malicious-iam-user-1-access-key",
            "path": "GuarddutyHandsOnStack/malicious-iam-user-1-access-key",
            "children": {
              "Resource": {
                "id": "Resource",
                "path": "GuarddutyHandsOnStack/malicious-iam-user-1-access-key/Resource",
                "attributes": {
                  "aws:cdk:cloudformation:type": "AWS::IAM::AccessKey",
                  "aws:cdk:cloudformation:props": {
                    "userName": {
                      "Ref": "maliciousiamuser198EE1146"
                    },
                    "serial": 1
                  }
                },
                "constructInfo": {
                  "fqn": "aws-cdk-lib.aws_iam.CfnAccessKey",
                  "version": "2.17.0"
                }
              }
            },
            "constructInfo": {
              "fqn": "aws-cdk-lib.aws_iam.AccessKey",
              "version": "2.17.0"
            }
          },
          "malicious-instance-1": {
            "id": "malicious-instance-1",
            "path": "GuarddutyHandsOnStack/malicious-instance-1",
            "children": {
              "InstanceProfile": {
                "id": "InstanceProfile",
                "path": "GuarddutyHandsOnStack/malicious-instance-1/InstanceProfile",
                "attributes": {
                  "aws:cdk:cloudformation:type": "AWS::IAM::InstanceProfile",
                  "aws:cdk:cloudformation:props": {
                    "roles": [
                      {
                        "Ref": "roleC7B7E775"
                      }
                    ]
                  }
                },
                "constructInfo": {
                  "fqn": "aws-cdk-lib.aws_iam.CfnInstanceProfile",
                  "version": "2.17.0"
                }
              },
              "Resource": {
                "id": "Resource",
                "path": "GuarddutyHandsOnStack/malicious-instance-1/Resource",
                "attributes": {
                  "aws:cdk:cloudformation:type": "AWS::EC2::Instance",
                  "aws:cdk:cloudformation:props": {
                    "availabilityZone": "us-east-1a",
                    "iamInstanceProfile": {
                      "Ref": "maliciousinstance1InstanceProfile8655F490"
                    },
                    "imageId": {
                      "Ref": "SsmParameterValueawsserviceamiamazonlinuxlatestamzn2amihvmx8664gp2C96584B6F00A464EAD1953AFF4B05118Parameter"
                    },
                    "instanceType": "t3.micro",
                    "securityGroupIds": [
                      {
                        "Fn::GetAtt": [
                          "securitygroupE7525979",
                          "GroupId"
                        ]
                      }
                    ],
                    "subnetId": "subnet-088b2af56aef1a7dd",
                    "tags": [
                      {
                        "key": "Name",
                        "value": "GuardDuty-HandsOn-MaliciousInstance-Scenario-1-2"
                      }
                    ],
                    "userData": {
                      "Fn::Base64": {
                        "Fn::Join": [
                          "",
                          [
                            "#!/bin/bash\nmkdir /home/ec2-user/.aws\ntouch /home/ec2-user/.aws/credentials /home/ec2-user/.aws/config\ncat <<EOT >> /home/ec2-user/.aws/credentials\n[default]\naws_access_key_id = ",
                            {
                              "Ref": "maliciousiamuser1accesskey9FE1E6F7"
                            },
                            "\naws_secret_access_key = ",
                            {
                              "Fn::GetAtt": [
                                "maliciousiamuser1accesskey9FE1E6F7",
                                "SecretAccessKey"
                              ]
                            },
                            "\nEOT\nchmod 746 /home/ec2-user/.aws/credentials\nchown ec2-user /home/ec2-user/.aws/credentials\nchmod 746 /home/ec2-user/.aws/config\nchown ec2-user /home/ec2-user/.aws/config\ncat <<EOT >> /home/ec2-user/gd-findings.sh\n#!/bin/bash\naws configure set default.region us-east-1\naws iam get-user\naws iam create-user --user-name GuardDuty-HandsOn-Sarah\naws dynamodb list-tables\naws s3api list-buckets\naws ssm describe-parameters\naws ssm get-parameters --names ",
                            {
                              "Ref": "dynamodbpassword6C4B647F"
                            },
                            "\nsleep 10m\naws s3api list-objects --bucket ",
                            {
                              "Ref": "guarddutycompromisedbucket3451C9AD"
                            },
                            "\nEOT\nchmod 744 /home/ec2-user/gd-findings.sh\nchown ec2-user /home/ec2-user/gd-findings.sh\necho \"* * * * * /home/ec2-user/gd-findings.sh > /home/ec2-user/gd-findings.log 2>&1\" | tee -a /var/spool/cron/ec2-user"
                          ]
                        ]
                      }
                    }
                  }
                },
                "constructInfo": {
                  "fqn": "aws-cdk-lib.aws_ec2.CfnInstance",
                  "version": "2.17.0"
                }
              }
            },
            "constructInfo": {
              "fqn": "aws-cdk-lib.aws_ec2.Instance",
              "version": "2.17.0"
            }
          },
          "SsmParameterValue:--aws--service--ami-amazon-linux-latest--amzn2-ami-hvm-x86_64-gp2:C96584B6-F00A-464E-AD19-53AFF4B05118.Parameter": {
            "id": "SsmParameterValue:--aws--service--ami-amazon-linux-latest--amzn2-ami-hvm-x86_64-gp2:C96584B6-F00A-464E-AD19-53AFF4B05118.Parameter",
            "path": "GuarddutyHandsOnStack/SsmParameterValue:--aws--service--ami-amazon-linux-latest--amzn2-ami-hvm-x86_64-gp2:C96584B6-F00A-464E-AD19-53AFF4B05118.Parameter",
            "constructInfo": {
              "fqn": "aws-cdk-lib.CfnParameter",
              "version": "2.17.0"
            }
          },
          "SsmParameterValue:--aws--service--ami-amazon-linux-latest--amzn2-ami-hvm-x86_64-gp2:C96584B6-F00A-464E-AD19-53AFF4B05118": {
            "id": "SsmParameterValue:--aws--service--ami-amazon-linux-latest--amzn2-ami-hvm-x86_64-gp2:C96584B6-F00A-464E-AD19-53AFF4B05118",
            "path": "GuarddutyHandsOnStack/SsmParameterValue:--aws--service--ami-amazon-linux-latest--amzn2-ami-hvm-x86_64-gp2:C96584B6-F00A-464E-AD19-53AFF4B05118",
            "constructInfo": {
              "fqn": "aws-cdk-lib.Resource",
              "version": "2.17.0"
            }
          },
          "malicious-ip": {
            "id": "malicious-ip",
            "path": "GuarddutyHandsOnStack/malicious-ip",
            "attributes": {
              "aws:cdk:cloudformation:type": "AWS::EC2::EIP",
              "aws:cdk:cloudformation:props": {
                "domain": "vpc",
                "instanceId": {
                  "Ref": "maliciousinstance1990A55DC"
                }
              }
            },
            "constructInfo": {
              "fqn": "aws-cdk-lib.aws_ec2.CfnEIP",
              "version": "2.17.0"
            }
          },
          "malicious-iam-user-2-policy": {
            "id": "malicious-iam-user-2-policy",
            "path": "GuarddutyHandsOnStack/malicious-iam-user-2-policy",
            "children": {
              "Resource": {
                "id": "Resource",
                "path": "GuarddutyHandsOnStack/malicious-iam-user-2-policy/Resource",
                "attributes": {
                  "aws:cdk:cloudformation:type": "AWS::IAM::Policy",
                  "aws:cdk:cloudformation:props": {
                    "policyDocument": {
                      "Statement": [
                        {
                          "Action": [
                            "s3:PutBucketPublicAccessBlock",
                            "s3:PutBucketLogging"
                          ],
                          "Effect": "Allow",
                          "Resource": "arn:aws:s3::*"
                        }
                      ],
                      "Version": "2012-10-17"
                    },
                    "policyName": "maliciousiamuser2policyAA048536",
                    "users": [
                      {
                        "Ref": "maliciousiamuser2AF23258D"
                      }
                    ]
                  }
                },
                "constructInfo": {
                  "fqn": "aws-cdk-lib.aws_iam.CfnPolicy",
                  "version": "2.17.0"
                }
              }
            },
            "constructInfo": {
              "fqn": "aws-cdk-lib.aws_iam.Policy",
              "version": "2.17.0"
            }
          },
          "malicious-iam-user-2": {
            "id": "malicious-iam-user-2",
            "path": "GuarddutyHandsOnStack/malicious-iam-user-2",
            "children": {
              "Resource": {
                "id": "Resource",
                "path": "GuarddutyHandsOnStack/malicious-iam-user-2/Resource",
                "attributes": {
                  "aws:cdk:cloudformation:type": "AWS::IAM::User",
                  "aws:cdk:cloudformation:props": {}
                },
                "constructInfo": {
                  "fqn": "aws-cdk-lib.aws_iam.CfnUser",
                  "version": "2.17.0"
                }
              }
            },
            "constructInfo": {
              "fqn": "aws-cdk-lib.aws_iam.User",
              "version": "2.17.0"
            }
          },
          "malicious-iam-user-2-access-key": {
            "id": "malicious-iam-user-2-access-key",
            "path": "GuarddutyHandsOnStack/malicious-iam-user-2-access-key",
            "children": {
              "Resource": {
                "id": "Resource",
                "path": "GuarddutyHandsOnStack/malicious-iam-user-2-access-key/Resource",
                "attributes": {
                  "aws:cdk:cloudformation:type": "AWS::IAM::AccessKey",
                  "aws:cdk:cloudformation:props": {
                    "userName": {
                      "Ref": "maliciousiamuser2AF23258D"
                    },
                    "serial": 1
                  }
                },
                "constructInfo": {
                  "fqn": "aws-cdk-lib.aws_iam.CfnAccessKey",
                  "version": "2.17.0"
                }
              }
            },
            "constructInfo": {
              "fqn": "aws-cdk-lib.aws_iam.AccessKey",
              "version": "2.17.0"
            }
          },
          "malicious-instance-2": {
            "id": "malicious-instance-2",
            "path": "GuarddutyHandsOnStack/malicious-instance-2",
            "children": {
              "InstanceProfile": {
                "id": "InstanceProfile",
                "path": "GuarddutyHandsOnStack/malicious-instance-2/InstanceProfile",
                "attributes": {
                  "aws:cdk:cloudformation:type": "AWS::IAM::InstanceProfile",
                  "aws:cdk:cloudformation:props": {
                    "roles": [
                      {
                        "Ref": "roleC7B7E775"
                      }
                    ]
                  }
                },
                "constructInfo": {
                  "fqn": "aws-cdk-lib.aws_iam.CfnInstanceProfile",
                  "version": "2.17.0"
                }
              },
              "Resource": {
                "id": "Resource",
                "path": "GuarddutyHandsOnStack/malicious-instance-2/Resource",
                "attributes": {
                  "aws:cdk:cloudformation:type": "AWS::EC2::Instance",
                  "aws:cdk:cloudformation:props": {
                    "availabilityZone": "us-east-1a",
                    "iamInstanceProfile": {
                      "Ref": "maliciousinstance2InstanceProfileC82101E9"
                    },
                    "imageId": {
                      "Ref": "SsmParameterValueawsserviceamiamazonlinuxlatestamzn2amihvmx8664gp2C96584B6F00A464EAD1953AFF4B05118Parameter"
                    },
                    "instanceType": "t3.micro",
                    "securityGroupIds": [
                      {
                        "Fn::GetAtt": [
                          "securitygroupE7525979",
                          "GroupId"
                        ]
                      }
                    ],
                    "subnetId": "subnet-088b2af56aef1a7dd",
                    "tags": [
                      {
                        "key": "Name",
                        "value": "GuardDuty-HandsOn-MaliciousInstance-Scenario-4"
                      }
                    ],
                    "userData": {
                      "Fn::Base64": {
                        "Fn::Join": [
                          "",
                          [
                            "#!/bin/bash\nmkdir /home/ec2-user/.aws\ntouch /home/ec2-user/.aws/credentials /home/ec2-user/.aws/config\ncat <<EOT >> /home/ec2-user/.aws/credentials\n[default]\naws_access_key_id = ",
                            {
                              "Ref": "maliciousiamuser2accesskey6C6479D4"
                            },
                            "\naws_secret_access_key = ",
                            {
                              "Fn::GetAtt": [
                                "maliciousiamuser2accesskey6C6479D4",
                                "SecretAccessKey"
                              ]
                            },
                            "\nEOT\nchmod 746 /home/ec2-user/.aws/credentials\nchown ec2-user /home/ec2-user/.aws/credentials\nchmod 746 /home/ec2-user/.aws/config\nchown ec2-user /home/ec2-user/.aws/config\nsleep 20m\ncat <<EOT >> /home/ec2-user/gd-findings.sh\n#!/bin/bash\naws configure set default.region us-east-1\naws s3api list-buckets\naws s3api delete-public-access-block --bucket ",
                            {
                              "Ref": "guarddutycompromisedbucket3451C9AD"
                            },
                            "\naws s3api put-bucket-logging --bucket ",
                            {
                              "Ref": "guarddutycompromisedbucket3451C9AD"
                            },
                            " --bucket-logging-status {}\nEOT\nchmod 744 /home/ec2-user/gd-findings.sh\nchown ec2-user /home/ec2-user/gd-findings.sh\necho \"* * * * * /home/ec2-user/gd-findings.sh > /home/ec2-user/gd-findings.log 2>&1\" | tee -a /var/spool/cron/ec2-user"
                          ]
                        ]
                      }
                    }
                  }
                },
                "constructInfo": {
                  "fqn": "aws-cdk-lib.aws_ec2.CfnInstance",
                  "version": "2.17.0"
                }
              }
            },
            "constructInfo": {
              "fqn": "aws-cdk-lib.aws_ec2.Instance",
              "version": "2.17.0"
            }
          },
          "compromised-instance-1": {
            "id": "compromised-instance-1",
            "path": "GuarddutyHandsOnStack/compromised-instance-1",
            "children": {
              "InstanceProfile": {
                "id": "InstanceProfile",
                "path": "GuarddutyHandsOnStack/compromised-instance-1/InstanceProfile",
                "attributes": {
                  "aws:cdk:cloudformation:type": "AWS::IAM::InstanceProfile",
                  "aws:cdk:cloudformation:props": {
                    "roles": [
                      {
                        "Ref": "roleC7B7E775"
                      }
                    ]
                  }
                },
                "constructInfo": {
                  "fqn": "aws-cdk-lib.aws_iam.CfnInstanceProfile",
                  "version": "2.17.0"
                }
              },
              "Resource": {
                "id": "Resource",
                "path": "GuarddutyHandsOnStack/compromised-instance-1/Resource",
                "attributes": {
                  "aws:cdk:cloudformation:type": "AWS::EC2::Instance",
                  "aws:cdk:cloudformation:props": {
                    "availabilityZone": "us-east-1a",
                    "iamInstanceProfile": {
                      "Ref": "compromisedinstance1InstanceProfile7E691FF3"
                    },
                    "imageId": {
                      "Ref": "SsmParameterValueawsserviceamiamazonlinuxlatestamzn2amihvmx8664gp2C96584B6F00A464EAD1953AFF4B05118Parameter"
                    },
                    "instanceType": "t3.micro",
                    "securityGroupIds": [
                      {
                        "Fn::GetAtt": [
                          "securitygroupE7525979",
                          "GroupId"
                        ]
                      }
                    ],
                    "subnetId": "subnet-088b2af56aef1a7dd",
                    "tags": [
                      {
                        "key": "Name",
                        "value": "GuardDuty-HandsOn-CompromisedInstance-Scenario-1"
                      }
                    ],
                    "userData": {
                      "Fn::Base64": {
                        "Fn::Join": [
                          "",
                          [
                            "#!/bin/bash\nexec > >(tee /var/log/user-data.log|logger -t user-data -s 2>/dev/console) 2>&1\nsleep 5m\necho BEGIN\necho \"* * * * * ping -c 6 -i 10 ",
                            {
                              "Ref": "maliciousip"
                            },
                            " | tee -a /var/spool/cron/ec2-user"
                          ]
                        ]
                      }
                    }
                  }
                },
                "constructInfo": {
                  "fqn": "aws-cdk-lib.aws_ec2.CfnInstance",
                  "version": "2.17.0"
                }
              }
            },
            "constructInfo": {
              "fqn": "aws-cdk-lib.aws_ec2.Instance",
              "version": "2.17.0"
            }
          },
          "compromised-role": {
            "id": "compromised-role",
            "path": "GuarddutyHandsOnStack/compromised-role",
            "children": {
              "Resource": {
                "id": "Resource",
                "path": "GuarddutyHandsOnStack/compromised-role/Resource",
                "attributes": {
                  "aws:cdk:cloudformation:type": "AWS::IAM::Role",
                  "aws:cdk:cloudformation:props": {
                    "assumeRolePolicyDocument": {
                      "Statement": [
                        {
                          "Action": "sts:AssumeRole",
                          "Effect": "Allow",
                          "Principal": {
                            "Service": "ec2.amazonaws.com"
                          }
                        }
                      ],
                      "Version": "2012-10-17"
                    },
                    "managedPolicyArns": [
                      {
                        "Fn::Join": [
                          "",
                          [
                            "arn:",
                            {
                              "Ref": "AWS::Partition"
                            },
                            ":iam::aws:policy/service-role/AmazonEC2RoleforSSM"
                          ]
                        ]
                      }
                    ],
                    "policies": [
                      {
                        "policyName": "GuardDutyCompromisedPolicy",
                        "policyDocument": {
                          "Statement": [
                            {
                              "Action": [
                                "ssm:PutParameter",
                                "ssm:DescribeParameters",
                                "ssm:GetParameters",
                                "ssm:DeleteParameter",
                                "dynamodb:*",
                                "guardduty:*",
                                "s3:PutObject",
                                "s3:PutAccountPublicAccessBlock",
                                "iam:PutRolePolicy"
                              ],
                              "Effect": "Allow",
                              "Resource": "*"
                            }
                          ],
                          "Version": "2012-10-17"
                        }
                      }
                    ]
                  }
                },
                "constructInfo": {
                  "fqn": "aws-cdk-lib.aws_iam.CfnRole",
                  "version": "2.17.0"
                }
              }
            },
            "constructInfo": {
              "fqn": "aws-cdk-lib.aws_iam.Role",
              "version": "2.17.0"
            }
          },
          "compromised-instance-2": {
            "id": "compromised-instance-2",
            "path": "GuarddutyHandsOnStack/compromised-instance-2",
            "children": {
              "InstanceProfile": {
                "id": "InstanceProfile",
                "path": "GuarddutyHandsOnStack/compromised-instance-2/InstanceProfile",
                "attributes": {
                  "aws:cdk:cloudformation:type": "AWS::IAM::InstanceProfile",
                  "aws:cdk:cloudformation:props": {
                    "roles": [
                      {
                        "Ref": "compromisedrole255096A1"
                      }
                    ]
                  }
                },
                "constructInfo": {
                  "fqn": "aws-cdk-lib.aws_iam.CfnInstanceProfile",
                  "version": "2.17.0"
                }
              },
              "Resource": {
                "id": "Resource",
                "path": "GuarddutyHandsOnStack/compromised-instance-2/Resource",
                "attributes": {
                  "aws:cdk:cloudformation:type": "AWS::EC2::Instance",
                  "aws:cdk:cloudformation:props": {
                    "availabilityZone": "us-east-1a",
                    "iamInstanceProfile": {
                      "Ref": "compromisedinstance2InstanceProfile34582177"
                    },
                    "imageId": {
                      "Ref": "SsmParameterValueawsserviceamiamazonlinuxlatestamzn2amihvmx8664gp2C96584B6F00A464EAD1953AFF4B05118Parameter"
                    },
                    "instanceType": "t3.micro",
                    "securityGroupIds": [
                      {
                        "Fn::GetAtt": [
                          "securitygroupE7525979",
                          "GroupId"
                        ]
                      }
                    ],
                    "subnetId": "subnet-088b2af56aef1a7dd",
                    "tags": [
                      {
                        "key": "Name",
                        "value": "GuardDuty-HandsOn-CompromisedInstance-Scenario-3"
                      }
                    ],
                    "userData": {
                      "Fn::Base64": {
                        "Fn::Join": [
                          "",
                          [
                            "#!/bin/bash\naws configure set default.region us-east-1\nuuid=$(uuidgen)\nlist=\"gd-threat-list-example-$uuid.txt\"\nmaliciousip=`curl http://169.254.169.254/latest/meta-data/public-ipv4`\necho ",
                            {
                              "Ref": "maliciousip"
                            },
                            " >> $list\naws s3 cp $list s3://",
                            {
                              "Ref": "guarddutythreatlistbucket8A240162"
                            },
                            "/$list\nsleep 5\naws s3control put-public-access-block --account-id 381354187112 --public-access-block-configuration \"BlockPublicAcls=true,IgnorePublicAcls=true,BlockPublicPolicy=true,RestrictPublicBuckets=true\"\nid=`aws guardduty list-detectors --query 'DetectorIds[0]' --output text`\nn=0\nuntil [ \"$n\" -ge 5 ]\ndo\n  aws guardduty create-threat-intel-set --activate --detector-id $id --format TXT --location https://s3.amazonaws.com/",
                            {
                              "Ref": "guarddutythreatlistbucket8A240162"
                            },
                            "/$list --name Example-Threat-List && break\n  n=$((n+1))\n  sleep 5\ndone\naws ssm put-parameter --name ",
                            {
                              "Ref": "dynamodbpassword6C4B647F"
                            },
                            " --type \"SecureString\" --value Password123 --overwrite\naws dynamodb put-item --table-name ",
                            {
                              "Ref": "TableCD117FA1"
                            },
                            " --item '{ \"name\": { \"S\": \"Joshua Tree\" }, \"state\": {\"S\": \"California\"}, \"website\":{\"S\": \"https://www.nps.gov/jotr/index.htm\"} }'"
                          ]
                        ]
                      }
                    }
                  }
                },
                "constructInfo": {
                  "fqn": "aws-cdk-lib.aws_ec2.CfnInstance",
                  "version": "2.17.0"
                }
              }
            },
            "constructInfo": {
              "fqn": "aws-cdk-lib.aws_ec2.Instance",
              "version": "2.17.0"
            }
          },
          "sns-topic": {
            "id": "sns-topic",
            "path": "GuarddutyHandsOnStack/sns-topic",
            "children": {
              "Resource": {
                "id": "Resource",
                "path": "GuarddutyHandsOnStack/sns-topic/Resource",
                "attributes": {
                  "aws:cdk:cloudformation:type": "AWS::SNS::Topic",
                  "aws:cdk:cloudformation:props": {}
                },
                "constructInfo": {
                  "fqn": "aws-cdk-lib.aws_sns.CfnTopic",
                  "version": "2.17.0"
                }
              },
              "shazi7804@gmail.com": {
                "id": "shazi7804@gmail.com",
                "path": "GuarddutyHandsOnStack/sns-topic/shazi7804@gmail.com",
                "children": {
                  "Resource": {
                    "id": "Resource",
                    "path": "GuarddutyHandsOnStack/sns-topic/shazi7804@gmail.com/Resource",
                    "attributes": {
                      "aws:cdk:cloudformation:type": "AWS::SNS::Subscription",
                      "aws:cdk:cloudformation:props": {
                        "protocol": "email",
                        "topicArn": {
                          "Ref": "snstopic2C4AE3C1"
                        },
                        "endpoint": "shazi7804@gmail.com"
                      }
                    },
                    "constructInfo": {
                      "fqn": "aws-cdk-lib.aws_sns.CfnSubscription",
                      "version": "2.17.0"
                    }
                  }
                },
                "constructInfo": {
                  "fqn": "aws-cdk-lib.aws_sns.Subscription",
                  "version": "2.17.0"
                }
              },
              "Policy": {
                "id": "Policy",
                "path": "GuarddutyHandsOnStack/sns-topic/Policy",
                "children": {
                  "Resource": {
                    "id": "Resource",
                    "path": "GuarddutyHandsOnStack/sns-topic/Policy/Resource",
                    "attributes": {
                      "aws:cdk:cloudformation:type": "AWS::SNS::TopicPolicy",
                      "aws:cdk:cloudformation:props": {
                        "policyDocument": {
                          "Statement": [
                            {
                              "Action": "sns:Publish",
                              "Effect": "Allow",
                              "Principal": {
                                "Service": "events.amazonaws.com"
                              },
                              "Resource": {
                                "Ref": "snstopic2C4AE3C1"
                              },
                              "Sid": "0"
                            }
                          ],
                          "Version": "2012-10-17"
                        },
                        "topics": [
                          {
                            "Ref": "snstopic2C4AE3C1"
                          }
                        ]
                      }
                    },
                    "constructInfo": {
                      "fqn": "aws-cdk-lib.aws_sns.CfnTopicPolicy",
                      "version": "2.17.0"
                    }
                  }
                },
                "constructInfo": {
                  "fqn": "aws-cdk-lib.aws_sns.TopicPolicy",
                  "version": "2.17.0"
                }
              }
            },
            "constructInfo": {
              "fqn": "aws-cdk-lib.aws_sns.Topic",
              "version": "2.17.0"
            }
          },
          "sns-topic-policy": {
            "id": "sns-topic-policy",
            "path": "GuarddutyHandsOnStack/sns-topic-policy",
            "children": {
              "Resource": {
                "id": "Resource",
                "path": "GuarddutyHandsOnStack/sns-topic-policy/Resource",
                "attributes": {
                  "aws:cdk:cloudformation:type": "AWS::SNS::TopicPolicy",
                  "aws:cdk:cloudformation:props": {
                    "policyDocument": {
                      "Statement": [
                        {
                          "Action": "sns:Publish",
                          "Effect": "Allow",
                          "Principal": {
                            "Service": "events.amazonaws.com"
                          },
                          "Resource": {
                            "Ref": "snstopic2C4AE3C1"
                          },
                          "Sid": "0"
                        }
                      ],
                      "Version": "2012-10-17"
                    },
                    "topics": [
                      {
                        "Ref": "snstopic2C4AE3C1"
                      }
                    ]
                  }
                },
                "constructInfo": {
                  "fqn": "aws-cdk-lib.aws_sns.CfnTopicPolicy",
                  "version": "2.17.0"
                }
              }
            },
            "constructInfo": {
              "fqn": "aws-cdk-lib.aws_sns.TopicPolicy",
              "version": "2.17.0"
            }
          },
          "remediation-lambda-role": {
            "id": "remediation-lambda-role",
            "path": "GuarddutyHandsOnStack/remediation-lambda-role",
            "children": {
              "Resource": {
                "id": "Resource",
                "path": "GuarddutyHandsOnStack/remediation-lambda-role/Resource",
                "attributes": {
                  "aws:cdk:cloudformation:type": "AWS::IAM::Role",
                  "aws:cdk:cloudformation:props": {
                    "assumeRolePolicyDocument": {
                      "Statement": [
                        {
                          "Action": "sts:AssumeRole",
                          "Effect": "Allow",
                          "Principal": {
                            "Service": "lambda.amazonaws.com"
                          }
                        }
                      ],
                      "Version": "2012-10-17"
                    },
                    "policies": [
                      {
                        "policyName": "InstanceCredentialExfiltration",
                        "policyDocument": {
                          "Statement": [
                            {
                              "Action": [
                                "ssm:DescribeParameters",
                                "ssm:GetParameter",
                                "ssm:GetParameters",
                                "ec2:ReplaceIamInstanceProfileAssociation",
                                "ec2:DescribeIamInstanceProfileAssociations",
                                "iam:CreateInstanceProfile",
                                "iam:AddRoleToInstanceProfile",
                                "iam:RemoveRoleFromInstanceProfile",
                                "iam:ListInstanceProfilesForRole",
                                "iam:DeleteInstanceProfile",
                                "iam:PassRole",
                                "iam:PutRolePolicy",
                                "sns:Publish",
                                "logs:CreateLogGroup",
                                "logs:CreateLogStream",
                                "logs:PutLogEvents"
                              ],
                              "Effect": "Allow",
                              "Resource": "*"
                            }
                          ],
                          "Version": "2012-10-17"
                        }
                      }
                    ]
                  }
                },
                "constructInfo": {
                  "fqn": "aws-cdk-lib.aws_iam.CfnRole",
                  "version": "2.17.0"
                }
              }
            },
            "constructInfo": {
              "fqn": "aws-cdk-lib.aws_iam.Role",
              "version": "2.17.0"
            }
          },
          "remediation-lambda": {
            "id": "remediation-lambda",
            "path": "GuarddutyHandsOnStack/remediation-lambda",
            "children": {
              "Code": {
                "id": "Code",
                "path": "GuarddutyHandsOnStack/remediation-lambda/Code",
                "children": {
                  "Stage": {
                    "id": "Stage",
                    "path": "GuarddutyHandsOnStack/remediation-lambda/Code/Stage",
                    "constructInfo": {
                      "fqn": "aws-cdk-lib.AssetStaging",
                      "version": "2.17.0"
                    }
                  },
                  "AssetBucket": {
                    "id": "AssetBucket",
                    "path": "GuarddutyHandsOnStack/remediation-lambda/Code/AssetBucket",
                    "constructInfo": {
                      "fqn": "aws-cdk-lib.aws_s3.BucketBase",
                      "version": "2.17.0"
                    }
                  }
                },
                "constructInfo": {
                  "fqn": "aws-cdk-lib.aws_s3_assets.Asset",
                  "version": "2.17.0"
                }
              },
              "Resource": {
                "id": "Resource",
                "path": "GuarddutyHandsOnStack/remediation-lambda/Resource",
                "attributes": {
                  "aws:cdk:cloudformation:type": "AWS::Lambda::Function",
                  "aws:cdk:cloudformation:props": {
                    "code": {
                      "s3Bucket": "cdk-hnb659fds-assets-381354187112-us-east-1",
                      "s3Key": "45f6b5df3f44fc0817ebd88d63af95010b09bf84971e80dbae3e41be35befa7f.zip"
                    },
                    "role": {
                      "Fn::GetAtt": [
                        "remediationlambdarole04C3A7FB",
                        "Arn"
                      ]
                    },
                    "environment": {
                      "variables": {
                        "TOPIC_ARN": {
                          "Ref": "snstopic2C4AE3C1"
                        }
                      }
                    },
                    "handler": "index.handler",
                    "runtime": "python3.8",
                    "timeout": 35
                  }
                },
                "constructInfo": {
                  "fqn": "aws-cdk-lib.aws_lambda.CfnFunction",
                  "version": "2.17.0"
                }
              }
            },
            "constructInfo": {
              "fqn": "aws-cdk-lib.aws_lambda.Function",
              "version": "2.17.0"
            }
          },
          "guardduty-ec2-event-rule": {
            "id": "guardduty-ec2-event-rule",
            "path": "GuarddutyHandsOnStack/guardduty-ec2-event-rule",
            "children": {
              "Resource": {
                "id": "Resource",
                "path": "GuarddutyHandsOnStack/guardduty-ec2-event-rule/Resource",
                "attributes": {
                  "aws:cdk:cloudformation:type": "AWS::Events::Rule",
                  "aws:cdk:cloudformation:props": {
                    "eventPattern": {
                      "source": [
                        "aws.guardduty"
                      ],
                      "detail": {
                        "type": [
                          "UnauthorizedAccess:EC2/MaliciousIPCaller.Custom"
                        ]
                      }
                    },
                    "name": "GuardDuty-HandsOn-EC2-MaliciousIPCaller",
                    "state": "ENABLED",
                    "targets": [
                      {
                        "id": "Target0",
                        "arn": {
                          "Fn::GetAtt": [
                            "remediationlambda13A57A86",
                            "Arn"
                          ]
                        }
                      },
                      {
                        "id": "Target1",
                        "arn": {
                          "Ref": "snstopic2C4AE3C1"
                        },
                        "inputTransformer": {
                          "inputTemplate": "\"GuardDuty Finding | ID:<detail-id>: The EC2 instance <detail-resource-instanceDetails-instanceId> may be compromised and should be investigated. Go to https://console.aws.amazon.com/guardduty/home?region=<detail-region>#/findings?macros=current&fId=<detail-id>\"",
                          "inputPathsMap": {
                            "detail-id": "$.detail.id",
                            "detail-resource-instanceDetails-instanceId": "$.detail.resource.instanceDetails.instanceId",
                            "detail-region": "$.detail.region"
                          }
                        }
                      }
                    ]
                  }
                },
                "constructInfo": {
                  "fqn": "aws-cdk-lib.aws_events.CfnRule",
                  "version": "2.17.0"
                }
              },
              "AllowEventRuleGuarddutyHandsOnStackremediationlambda76902498": {
                "id": "AllowEventRuleGuarddutyHandsOnStackremediationlambda76902498",
                "path": "GuarddutyHandsOnStack/guardduty-ec2-event-rule/AllowEventRuleGuarddutyHandsOnStackremediationlambda76902498",
                "attributes": {
                  "aws:cdk:cloudformation:type": "AWS::Lambda::Permission",
                  "aws:cdk:cloudformation:props": {
                    "action": "lambda:InvokeFunction",
                    "functionName": {
                      "Fn::GetAtt": [
                        "remediationlambda13A57A86",
                        "Arn"
                      ]
                    },
                    "principal": "events.amazonaws.com",
                    "sourceArn": {
                      "Fn::GetAtt": [
                        "guarddutyec2eventrule444DBD64",
                        "Arn"
                      ]
                    }
                  }
                },
                "constructInfo": {
                  "fqn": "aws-cdk-lib.aws_lambda.CfnPermission",
                  "version": "2.17.0"
                }
              }
            },
            "constructInfo": {
              "fqn": "aws-cdk-lib.aws_events.Rule",
              "version": "2.17.0"
            }
          },
          "guardduty-event-iam-instance-credential-exfiltration-rule": {
            "id": "guardduty-event-iam-instance-credential-exfiltration-rule",
            "path": "GuarddutyHandsOnStack/guardduty-event-iam-instance-credential-exfiltration-rule",
            "children": {
              "Resource": {
                "id": "Resource",
                "path": "GuarddutyHandsOnStack/guardduty-event-iam-instance-credential-exfiltration-rule/Resource",
                "attributes": {
                  "aws:cdk:cloudformation:type": "AWS::Events::Rule",
                  "aws:cdk:cloudformation:props": {
                    "eventPattern": {
                      "source": [
                        "aws.guardduty"
                      ],
                      "detail": {
                        "type": [
                          "UnauthorizedAccess:IAMUser/InstanceCredentialExfiltration.OutsideAWS"
                        ]
                      }
                    },
                    "name": "GuardDuty-HandsOn-IAMUser-InstanceCredentialExfiltration",
                    "state": "ENABLED",
                    "targets": [
                      {
                        "id": "Target0",
                        "arn": {
                          "Fn::GetAtt": [
                            "remediationlambda13A57A86",
                            "Arn"
                          ]
                        }
                      },
                      {
                        "id": "Target1",
                        "arn": {
                          "Ref": "snstopic2C4AE3C1"
                        },
                        "inputTransformer": {
                          "inputTemplate": "\"GuardDuty Finding | ID:<detail-id>: An EC2 instance IAM credentials (Role: <detail-resource-accessKeyDetails-userName>) may be compromised and should be investigated. Go to https://console.aws.amazon.com/guardduty/home?region=<detail-region>#/findings?macros=current&fId=<detail-id>\"",
                          "inputPathsMap": {
                            "detail-id": "$.detail.id",
                            "detail-resource-accessKeyDetails-userName": "$.detail.resource.accessKeyDetails.userName",
                            "detail-region": "$.detail.region"
                          }
                        }
                      }
                    ]
                  }
                },
                "constructInfo": {
                  "fqn": "aws-cdk-lib.aws_events.CfnRule",
                  "version": "2.17.0"
                }
              },
              "AllowEventRuleGuarddutyHandsOnStackremediationlambda76902498": {
                "id": "AllowEventRuleGuarddutyHandsOnStackremediationlambda76902498",
                "path": "GuarddutyHandsOnStack/guardduty-event-iam-instance-credential-exfiltration-rule/AllowEventRuleGuarddutyHandsOnStackremediationlambda76902498",
                "attributes": {
                  "aws:cdk:cloudformation:type": "AWS::Lambda::Permission",
                  "aws:cdk:cloudformation:props": {
                    "action": "lambda:InvokeFunction",
                    "functionName": {
                      "Fn::GetAtt": [
                        "remediationlambda13A57A86",
                        "Arn"
                      ]
                    },
                    "principal": "events.amazonaws.com",
                    "sourceArn": {
                      "Fn::GetAtt": [
                        "guarddutyeventiaminstancecredentialexfiltrationrule7E7F570C",
                        "Arn"
                      ]
                    }
                  }
                },
                "constructInfo": {
                  "fqn": "aws-cdk-lib.aws_lambda.CfnPermission",
                  "version": "2.17.0"
                }
              }
            },
            "constructInfo": {
              "fqn": "aws-cdk-lib.aws_events.Rule",
              "version": "2.17.0"
            }
          },
          "guardduty-iam-user-event-rule": {
            "id": "guardduty-iam-user-event-rule",
            "path": "GuarddutyHandsOnStack/guardduty-iam-user-event-rule",
            "children": {
              "Resource": {
                "id": "Resource",
                "path": "GuarddutyHandsOnStack/guardduty-iam-user-event-rule/Resource",
                "attributes": {
                  "aws:cdk:cloudformation:type": "AWS::Events::Rule",
                  "aws:cdk:cloudformation:props": {
                    "eventPattern": {
                      "source": [
                        "aws.guardduty"
                      ],
                      "detail": {
                        "type": [
                          "UnauthorizedAccess:IAMUser/MaliciousIPCaller.Custom",
                          "Discovery:S3/MaliciousIPCaller.Custom"
                        ]
                      }
                    },
                    "name": "GuardDuty-HandsOn-IAMUser-MaliciousIPCaller",
                    "state": "ENABLED",
                    "targets": [
                      {
                        "id": "Target0",
                        "arn": {
                          "Ref": "snstopic2C4AE3C1"
                        },
                        "inputTransformer": {
                          "inputTemplate": "\"GuardDuty Finding | ID:<detail-id>: An AWS API operation was invoked (userName: <detail-resource-accessKeyDetails-userName>) from an IP address that is included on your threat list and should be investigated. Go to https://console.aws.amazon.com/guardduty/home?region=<detail-region>#/findings?macros=current&fId=<detail-id>\"",
                          "inputPathsMap": {
                            "detail-id": "$.detail.id",
                            "detail-resource-accessKeyDetails-userName": "$.detail.resource.accessKeyDetails.userName",
                            "detail-region": "$.detail.region"
                          }
                        }
                      }
                    ]
                  }
                },
                "constructInfo": {
                  "fqn": "aws-cdk-lib.aws_events.CfnRule",
                  "version": "2.17.0"
                }
              }
            },
            "constructInfo": {
              "fqn": "aws-cdk-lib.aws_events.Rule",
              "version": "2.17.0"
            }
          },
          "guardduty-bucket-stealth-event-rule": {
            "id": "guardduty-bucket-stealth-event-rule",
            "path": "GuarddutyHandsOnStack/guardduty-bucket-stealth-event-rule",
            "children": {
              "Resource": {
                "id": "Resource",
                "path": "GuarddutyHandsOnStack/guardduty-bucket-stealth-event-rule/Resource",
                "attributes": {
                  "aws:cdk:cloudformation:type": "AWS::Events::Rule",
                  "aws:cdk:cloudformation:props": {
                    "eventPattern": {
                      "source": [
                        "aws.guardduty"
                      ],
                      "detail": {
                        "type": [
                          "Policy:S3/BucketBlockPublicAccessDisabled",
                          "Stealth:S3/ServerAccessLoggingDisabled"
                        ]
                      }
                    },
                    "name": "GuardDuty-HandsOn-S3-Stealth-Policy",
                    "state": "ENABLED",
                    "targets": [
                      {
                        "id": "Target0",
                        "arn": {
                          "Ref": "snstopic2C4AE3C1"
                        },
                        "inputTransformer": {
                          "inputTemplate": "\"GuardDuty Finding | ID:<detail-id>: An AWS S3 related API operation was invoked by user (userName: <detail-resource-accessKeyDetails-userName>) in account <detail-accountId> . This activity seems suspicious. Please investigate with the user to check if this was expectated behaviour. Go to https://console.aws.amazon.com/guardduty/home?region=<detail-region>#/findings?macros=current&fId=<detail-id>\"",
                          "inputPathsMap": {
                            "detail-id": "$.detail.id",
                            "detail-resource-accessKeyDetails-userName": "$.detail.resource.accessKeyDetails.userName",
                            "detail-accountId": "$.detail.accountId",
                            "detail-region": "$.detail.region"
                          }
                        }
                      }
                    ]
                  }
                },
                "constructInfo": {
                  "fqn": "aws-cdk-lib.aws_events.CfnRule",
                  "version": "2.17.0"
                }
              }
            },
            "constructInfo": {
              "fqn": "aws-cdk-lib.aws_events.Rule",
              "version": "2.17.0"
            }
          },
          "CDKMetadata": {
            "id": "CDKMetadata",
            "path": "GuarddutyHandsOnStack/CDKMetadata",
            "children": {
              "Default": {
                "id": "Default",
                "path": "GuarddutyHandsOnStack/CDKMetadata/Default",
                "constructInfo": {
                  "fqn": "aws-cdk-lib.CfnResource",
                  "version": "2.17.0"
                }
              }
            },
            "constructInfo": {
              "fqn": "constructs.Construct",
              "version": "10.0.91"
            }
          }
        },
        "constructInfo": {
          "fqn": "aws-cdk-lib.Stack",
          "version": "2.17.0"
        }
      }
    },
    "constructInfo": {
      "fqn": "aws-cdk-lib.App",
      "version": "2.17.0"
    }
  }
}